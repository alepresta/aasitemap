<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Dominios - Sitemap</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: none;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .result-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        .url-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .url-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #764ba2;
            word-break: break-all;
        }
        .stats {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-sitemap"></i> Analizador de Dominios</h1>
            <p>Descubre todas las páginas de cualquier sitio web</p>
        </div>

        <div class="card">
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-8">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text"><i class="fas fa-globe"></i></span>
                            <input type="text" id="domainInput" class="form-control"
                                   placeholder="Ingresa un dominio (ej: ejemplo.com)"
                                   value="http://85.31.224.145:6000/">
                            <button class="btn btn-primary" onclick="analyzeDomain()">
                                <i class="fas fa-search"></i> Analizar
                            </button>
                        </div>
                        <div class="form-text mt-2">
                            Puedes ingresar con o sin "https://". Ejemplos: google.com, https://example.org
                        </div>
                    </div>
                    <div class="col-md-4 d-flex align-items-center">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="fastMode" checked>
                            <label class="form-check-label" for="fastMode">Modo rápido (limita a 50 páginas)</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <h4>Analizando dominio...</h4>
            <p>Esto puede tomar unos segundos. Por favor, espera.</p>
            <div class="progress mt-3">
                <div class="progress-bar progress-bar-striped progress-bar-animated"
                     style="width: 100%"></div>
            </div>
        </div>

        <div class="card mt-4 d-none" id="resultsCard">
            <div class="card-body p-4">
                <h3 class="mb-4"><i class="fas fa-chart-bar"></i> Resultados del Análisis</h3>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="result-card p-3">
                            <h5><i class="fas fa-info-circle"></i> Información del Dominio</h5>
                            <div id="domainInfo"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card p-3">
                            <h5><i class="fas fa-chart-pie"></i> Estadísticas</h5>
                            <div id="statsInfo" class="stats"></div>
                        </div>
                    </div>
                </div>

                <h5 class="mb-3"><i class="fas fa-list"></i> Páginas Encontradas (<span id="pageCount">0</span>)</h5>
                <div class="url-list" id="urlList"></div>

                <div class="mt-4">
                    <button class="btn btn-success" onclick="exportResults()">
                        <i class="fas fa-download"></i> Exportar Resultados
                    </button>
                    <button class="btn btn-outline-primary ms-2" onclick="copyToClipboard()">
                        <i class="fas fa-copy"></i> Copiar URLs
                    </button>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h5><i class="fas fa-lightbulb"></i> ¿Cómo funciona?</h5>
                <ul>
                    <li>El sistema analiza el dominio ingresado y busca todas las páginas internas</li>
                    <li>Primero intenta localizar el archivo sitemap.xml</li>
                    <li>Si no existe, realiza un crawling inteligente del sitio</li>
                    <li>Respeta los tiempos del servidor y no sobrecarga el sitio objetivo</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function analyzeDomain() {
            const domain = document.getElementById('domainInput').value.trim();
            const fastMode = document.getElementById('fastMode').checked;

            if (!domain) {
                alert('Por favor, ingresa un dominio');
                return;
            }

            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsCard').classList.add('d-none');

            // Configurar límites según el modo
            const maxUrls = fastMode ? 50 : 100;

            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    domain: domain,
                    maxUrls: maxUrls
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';

                if (data.error) {
                    alert('Error: ' + data.error);
                    return;
                }

                displayResults(data);
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                alert('Error al conectar con el servidor: ' + error.message);
            });
        }

        function displayResults(data) {
            // Mostrar información del dominio
            document.getElementById('domainInfo').innerHTML = `
                <p><strong>Dominio:</strong> ${data.domain}</p>
                <p><strong>Total de URLs encontradas:</strong> ${data.total_pages}</p>
                <p><strong>Páginas analizadas:</strong> ${data.visited_pages}</p>
            `;

            // Mostrar estadísticas
            document.getElementById('statsInfo').innerHTML = `
                <div class="text-success">
                    <i class="fas fa-check-circle"></i>
                    ${data.total_pages} páginas identificadas
                </div>
            `;

            // Mostrar lista de URLs
            const urlList = document.getElementById('urlList');
            const pageCount = document.getElementById('pageCount');

            urlList.innerHTML = '';
            pageCount.textContent = data.pages.length;

            data.pages.forEach((url, index) => {
                const urlElement = document.createElement('div');
                urlElement.className = 'url-item';
                urlElement.innerHTML = `
                    <span class="badge bg-secondary me-2">${index + 1}</span>
                    <a href="${url}" target="_blank" class="text-decoration-none">
                        ${url}
                    </a>
                `;
                urlList.appendChild(urlElement);
            });

            // Mostrar la tarjeta de resultados
            document.getElementById('resultsCard').classList.remove('d-none');
        }

        function exportResults() {
            const urls = Array.from(document.querySelectorAll('.url-item a'))
                .map(a => a.href)
                .join('\n');

            const blob = new Blob([urls], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sitemap_urls.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function copyToClipboard() {
            const urls = Array.from(document.querySelectorAll('.url-item a'))
                .map(a => a.href)
                .join('\n');

            navigator.clipboard.writeText(urls)
                .then(() => alert('URLs copiadas al portapapeles'))
                .catch(err => alert('Error al copiar: ' + err));
        }

        // Permitir Enter para enviar
        document.getElementById('domainInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeDomain();
            }
        });
    </script>
</body>
</html>